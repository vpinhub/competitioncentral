<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VPINHUB | Competition Archive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Encode+Sans:wght@400;700;900&family=MedievalSharp&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Encode Sans', sans-serif; background: #020617; color: white; transition: background 0.5s ease; }
        .medieval { font-family: 'MedievalSharp', cursive; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.08); }
        .theme-throwdown { --accent: #f97316; background-color: #0c0a09; }
        .theme-swl { --accent: #d946ef; background-color: #0f0a0f; }
        .accent-text { color: var(--accent, #94a3b8); }
        .accent-border { border-color: var(--accent, #334155); }
        select { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); background-position: right 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em; padding-right: 2.5rem; -webkit-appearance: none; -moz-appearance: none; appearance: none; }
    </style>
</head>
<body class="min-h-screen">

    <div class="flex flex-col min-h-screen">
        <nav class="glass border-b border-white/10 p-6 sticky top-0 z-50">
            <div class="container mx-auto flex flex-col md:flex-row items-center justify-between gap-6">
                <div class="flex items-center gap-4">
                    <a href="index.html" class="bg-white/10 hover:bg-white/20 p-2 rounded-lg transition-colors">üè†</a>
                    <div>
                        <h1 class="text-2xl font-black italic tracking-tighter uppercase leading-none">VPIN<span class="text-orange-500">HUB</span></h1>
                        <p class="text-[10px] text-gray-500 font-bold uppercase tracking-widest mt-1">Historical Archive</p>
                    </div>
                </div>

                <div class="flex flex-col sm:flex-row gap-4 w-full md:w-auto">
                    <select id="type-filter" onchange="populateArchiveDropdown()" class="bg-white/5 border border-white/10 rounded-xl px-4 py-2 text-xs font-bold uppercase tracking-widest outline-none focus:border-orange-500 cursor-pointer min-w-[200px]">
                        <option value="all">All Competitions</option>
                        <option value="Thursday_Throwdown">Thursday Throwdown</option>
                        <option value="Special_When_Lit">Special When Lit</option>
                    </select>

                    <select id="archive-dropdown" onchange="handleSelection()" class="bg-white/5 border border-white/10 rounded-xl px-4 py-2 text-xs font-bold uppercase tracking-widest outline-none focus:border-orange-500 cursor-pointer min-w-[280px]">
                        <option value="">Select an Event...</option>
                    </select>
                </div>
            </div>
        </nav>

        <main class="flex-1 p-6 lg:p-12 overflow-y-auto">
            <div id="empty-state" class="h-full flex flex-col items-center justify-center text-center py-20">
                <div class="text-6xl mb-6">üèÜ</div>
                <h2 class="text-2xl font-bold mb-2">Archive Explorer</h2>
                <p class="text-gray-500 max-w-sm">Load historical tournament results to see final standings and seasonal awards.</p>
            </div>

            <div id="archive-content" class="hidden space-y-10 max-w-5xl mx-auto">
                <div class="text-center">
                    <div id="comp-label" class="inline-block px-4 py-1 rounded-full text-[10px] font-black uppercase tracking-widest bg-white/10 mb-4">Competition</div>
                    <h2 id="table-name" class="text-4xl font-black uppercase italic mb-2">Table Name</h2>
                    <p id="event-period" class="text-gray-400 font-bold"></p>
                </div>
                <div id="winner-banner"></div>
                <div id="achievements" class="grid grid-cols-1 md:grid-cols-3 gap-4"></div>
                <div class="glass rounded-3xl overflow-hidden shadow-2xl">
                    <div id="leaderboard" class="divide-y divide-white/5"></div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const AVATAR_BASE = "http://vpinhub.github.io/special-when-lit-leaderboard/img/";
        let allFiles = [];

        async function init() {
            try {
                // Fetch the manifest from the published GitHub Pages folder
                const response = await fetch('json/list.json');
                if (!response.ok) throw new Error();
                allFiles = await response.json();
                populateArchiveDropdown();
            } catch (err) {
                document.getElementById('archive-dropdown').innerHTML = `<option>No Archives Found</option>`;
            }
        }

        function populateArchiveDropdown() {
            const filter = document.getElementById('type-filter').value;
            const dropdown = document.getElementById('archive-dropdown');
            const filtered = allFiles.filter(f => filter === 'all' || f.name.startsWith(filter));
            dropdown.innerHTML = `<option value="">Select a competition record...</option>`;
            filtered.forEach(f => {
                const cleanName = f.name.replace('.json', '').replace(/_/g, ' ');
                const option = document.createElement('option');
                option.value = f.path; // This uses the relative path from list.json
                option.textContent = cleanName;
                dropdown.appendChild(option);
            });
        }

        function handleSelection() {
            const path = document.getElementById('archive-dropdown').value;
            if (path) loadArchiveData(path);
        }

        async function loadArchiveData(filePath) {
            const res = await fetch(filePath);
            const data = await res.json();
            document.getElementById('empty-state').classList.add('hidden');
            document.getElementById('archive-content').classList.remove('hidden');
            document.body.className = data.competition.includes('Throwdown') ? 'theme-throwdown' : 'theme-swl';
            document.getElementById('comp-label').innerText = data.competition.replace(/_/g, ' ');
            document.getElementById('table-name').innerText = data.table;
            document.getElementById('event-period').innerText = data.period;

            const winner = data.results[0];
            document.getElementById('winner-banner').innerHTML = `
                <div class="glass p-6 rounded-2xl border-2 accent-border flex flex-col md:flex-row items-center justify-between gap-6 shadow-2xl">
                    <div class="flex items-center gap-6">
                        <div class="relative">
                            <img src="${AVATAR_BASE}${winner.name.toLowerCase().replace(/\s+/g, '_')}.gif" class="w-20 h-20 rounded-full border-4 accent-border" onerror="this.src='https://via.placeholder.com/80?text=?'">
                            <span class="absolute -top-2 -right-2 text-3xl">üëë</span>
                        </div>
                        <div>
                            <div class="medieval text-xs accent-text uppercase tracking-widest">Tournament Winner</div>
                            <div class="text-3xl font-black italic uppercase">${winner.name}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-xs text-gray-400 font-bold uppercase">Record Score</div>
                        <div class="text-2xl font-mono font-bold accent-text">${winner.high.toLocaleString()}</div>
                    </div>
                </div>`;

            const a = data.awards || {};
            const card = (icon, title, name, color) => `<div class="glass p-4 rounded-xl border-l-4 ${color}"><div class="medieval text-[10px] text-gray-400 uppercase">${icon} ${title}</div><div class="font-bold text-sm uppercase italic text-white">${name || 'N/A'}</div></div>`;
            document.getElementById('achievements').innerHTML = card("üî´", "Fast Draw", a.fast_draw, "border-red-500") + card("üéØ", "Sharpshooter", a.sharpshooter, "border-orange-500") + card("üìà", "Most Improved", a.most_improved, "border-green-500") + card("üîÑ", "Comeback Kid", a.comeback_kid, "border-purple-500") + card("üïπÔ∏è", "Most Played", a.most_played, "border-blue-500") + card("‚ò¢Ô∏è", "Burns Award", a.burns_award, "border-yellow-500");

            document.getElementById('leaderboard').innerHTML = data.results.map((p, i) => `
                <div class="flex items-center justify-between px-8 py-4 hover:bg-white/5 transition">
                    <div class="flex items-center gap-4">
                        <span class="w-6 font-black text-xl italic ${i < 3 ? 'accent-text' : 'text-gray-700'}">${i+1}</span>
                        <img src="${AVATAR_BASE}${p.name.toLowerCase().replace(/\s+/g, '_')}.gif" class="w-10 h-10 rounded-full border border-white/10" onerror="this.src='https://via.placeholder.com/40?text=?'">
                        <span class="font-bold text-sm text-gray-200">${p.name}</span>
                    </div>
                    <span class="font-mono font-bold ${i === 0 ? 'text-yellow-400' : 'text-gray-400'}">${p.high.toLocaleString()}</span>
                </div>`).join('');
        }
        init();
    </script>
</body>
</html>
